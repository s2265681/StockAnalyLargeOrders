# ğŸ“ å‰ç«¯æ¥å£é€‚é…æ€»ç»“æŠ¥å‘Š

## ğŸ¯ é€‚é…ç›®æ ‡

æ ¹æ®æ¥å£åˆ†ææŠ¥å‘Š.mdä¸­çš„4ä¸ªç«å“APIæ¥å£ï¼Œå®Œæˆå‰ç«¯ä»£ç çš„é€‚é…ï¼Œç¡®ä¿èƒ½å¤Ÿæ­£ç¡®è°ƒç”¨åç«¯çš„æ–°æ¥å£æ ¼å¼ã€‚

## ğŸ”§ å·²å®Œæˆçš„é€‚é…å·¥ä½œ

### 1. æ›´æ–°çŠ¶æ€ç®¡ç† (atoms.js)

#### âœ… åŸºæœ¬ä¿¡æ¯æ¥å£é€‚é…
- **æ¥å£åœ°å€**: `/api/v1/base_info`
- **å“åº”æ ¼å¼**: `{ success: true, data: {...}, message: "success" }`
- **é€‚é…å†…å®¹**:
  - ä¿®æ”¹å“åº”æ£€æŸ¥ä» `data.code === 0` æ”¹ä¸º `data.success === true`
  - æ·»åŠ æ•°æ®æ ¼å¼è½¬æ¢é€»è¾‘ï¼Œç¡®ä¿å‰ç«¯æœŸæœ›çš„å­—æ®µæ ¼å¼
  - å•ä½è½¬æ¢ï¼šä¸‡æ‰‹è½¬æ‰‹æ•°ã€äº¿å…ƒè½¬å…ƒ

```javascript
// è½¬æ¢ç«å“æ¥å£æ ¼å¼ä¸ºå‰ç«¯æœŸæœ›æ ¼å¼
const baseInfo = data.data;
const convertedData = {
  code: baseInfo.code,
  name: baseInfo.name,
  current_price: baseInfo.current_price,
  // ... å…¶ä»–å­—æ®µæ˜ å°„
  volume: Math.round(baseInfo.volume * 10000), // è½¬æ¢ä¸‡æ‰‹ä¸ºæ‰‹
  turnover: Math.round(baseInfo.turnover * 100000000), // è½¬æ¢äº¿å…ƒä¸ºå…ƒ
};
```

#### âœ… å¤§å•æ•°æ®æ¥å£é€‚é…
- **ç»Ÿè®¡æ¥å£**: `/api/v1/dadantongji` (è¿”å›æ ¼å¼: `{ code: 0, msg: "æ“ä½œæˆåŠŸ", data: {...} }`)
- **æ˜ç»†æ¥å£**: `/api/v1/dadan` (è¿”å›æ ¼å¼: `{ success: true, data: {...}, message: "success" }`)
- **é€‚é…å†…å®¹**:
  - å¹¶è¡Œè°ƒç”¨ä¸¤ä¸ªæ¥å£è·å–å®Œæ•´æ•°æ®
  - å¤„ç†ä¸åŒçš„å“åº”æ ¼å¼æ£€æŸ¥
  - æ•°æ®åˆå¹¶å’Œæ ¼å¼è½¬æ¢

```javascript
// å¤„ç†ä¸åŒçš„å“åº”æ ¼å¼
if (statsData.code === 0 && dadanData.success === true) {
  const stats = statsData.data;
  const dadanResult = dadanData.data;
  const orders = dadanResult.dadan_list || [];
  // ... æ•°æ®å¤„ç†
}
```

#### âœ… åˆ†æ—¶å›¾æ¥å£é€‚é…
- **æ¥å£åœ°å€**: `/api/v1/quote`
- **å“åº”æ ¼å¼**: `{ success: true, data: {...}, message: "success" }`
- **é€‚é…å†…å®¹**:
  - å¤„ç†åˆ†æ—¶æ•°æ®æ•°ç»„çš„å®‰å…¨è§£æ
  - æ•°æ®ç±»å‹è½¬æ¢ç¡®ä¿æ•°å€¼æ­£ç¡®æ€§

#### âœ… å®æ—¶äº¤æ˜“æ•°æ®é€‚é…
- **æ¥å£åœ°å€**: `/api/v1/dadan` (å¤ç”¨å¤§å•æ˜ç»†æ¥å£)
- **é€‚é…å†…å®¹**:
  - ä»å¤§å•æ˜ç»†ä¸­æå–å®æ—¶äº¤æ˜“æ•°æ®
  - ä¹°å–çŠ¶æ€åˆ¤æ–­é€»è¾‘é€‚é…

### 2. æ•°æ®æ ¼å¼è½¬æ¢

#### âœ… é‡‘é¢å’Œæ•°é‡å•ä½ç»Ÿä¸€
- **ä¸‡å…ƒ â†’ å…ƒ**: `parseFloat(order.amount) * 10000`
- **ä¸‡æ‰‹ â†’ æ‰‹**: `Math.round(baseInfo.volume * 10000)`
- **äº¿å…ƒ â†’ å…ƒ**: `Math.round(baseInfo.turnover * 100000000)`

#### âœ… ä¹°å–çŠ¶æ€åˆ¤æ–­ä¼˜åŒ–
```javascript
// æ ¹æ®çŠ¶æ€æ–‡æœ¬åˆ¤æ–­ä¹°å–æ–¹å‘
type: order.status === 'è¢«ä¹°' || order.status === 'ä¸»ä¹°' ? 'buy' : 'sell'
```

#### âœ… è®¢å•åˆ†ç±»é€»è¾‘
```javascript
const determineCategory = (amount) => {
  if (amount >= 3000000) return 'D300';
  if (amount >= 1000000) return 'D100';
  if (amount >= 500000) return 'D50';
  if (amount >= 300000) return 'D30';
  return 'under_D30';
};
```

### 3. ç»„ä»¶å…¼å®¹æ€§æ›´æ–°

#### âœ… StockDashboardç»„ä»¶é€‚é…
- æ›´æ–°å¤§å•æ±‡æ€»æ•°æ®å‡½æ•°çš„é”™è¯¯å¤„ç†
- æ·»åŠ æ•°æ®å®‰å…¨æ€§æ£€æŸ¥ï¼Œé¿å…undefinedé”™è¯¯
- ä¿æŒåŸæœ‰UIé€»è¾‘ä¸å˜ï¼Œåªæ›´æ–°æ•°æ®æº

```javascript
// å®‰å…¨çš„æ•°æ®è®¿é—®
buyCount: stats.buy_count || 0,
sellCount: stats.sell_count || 0,
buyAmount: (stats.buy_amount || 0).toFixed(2),
sellAmount: (stats.sell_amount || 0).toFixed(2)
```

## ğŸ“Š æ¥å£å¯¹ç…§è¡¨

| åŠŸèƒ½ | æ–°æ¥å£åœ°å€ | å“åº”æ ¼å¼ | çŠ¶æ€ç å­—æ®µ | å‰ç«¯é€‚é…çŠ¶æ€ |
|------|-----------|----------|------------|-------------|
| åŸºæœ¬ä¿¡æ¯ | `/api/v1/base_info` | `{success, data, message}` | `success === true` | âœ… å®Œæˆ |
| å¤§å•ç»Ÿè®¡ | `/api/v1/dadantongji` | `{code, msg, data}` | `code === 0` | âœ… å®Œæˆ |
| å¤§å•æ˜ç»† | `/api/v1/dadan` | `{success, data, message}` | `success === true` | âœ… å®Œæˆ |
| åˆ†æ—¶æ•°æ® | `/api/v1/quote` | `{success, data, message}` | `success === true` | âœ… å®Œæˆ |

## ğŸ” å…³é”®é€‚é…ç‚¹

### 1. å“åº”æ ¼å¼å·®å¼‚å¤„ç†
- **ç«å“æ ¼å¼A**: `{ success: true, data: {...}, message: "success" }`
- **ç«å“æ ¼å¼B**: `{ code: 0, msg: "æ“ä½œæˆåŠŸ", data: {...} }`
- **é€‚é…æ–¹æ¡ˆ**: åœ¨æ¯ä¸ªæ¥å£è°ƒç”¨ä¸­åˆ†åˆ«å¤„ç†ä¸åŒçš„å“åº”æ ¼å¼

### 2. æ•°æ®ç»“æ„æ˜ å°„
```javascript
// å¤§å•æ˜ç»†æ•°æ®ç»“æ„é€‚é…
largeOrders: Array.isArray(orders) ? orders.map(order => ({
  time: order.time,
  type: order.status === 'è¢«ä¹°' || order.status === 'ä¸»ä¹°' ? 'buy' : 'sell',
  price: parseFloat(order.price),
  volume: parseInt(order.volume),
  amount: parseFloat(order.amount) * 10000, // ä¸‡å…ƒè½¬å…ƒ
  category: order.category || determineCategory(parseFloat(order.amount) * 10000)
})) : []
```

### 3. çº§åˆ«ç»Ÿè®¡æ•°æ®æ‰©å±•
```javascript
// æ–°å¢under_D30çº§åˆ«æ”¯æŒ
levelStats: {
  D300: { buy_count, sell_count, buy_amount, sell_amount },
  D100: { buy_count, sell_count, buy_amount, sell_amount },
  D50: { buy_count, sell_count, buy_amount, sell_amount },
  D30: { buy_count, sell_count, buy_amount, sell_amount },
  under_D30: { buy_count, sell_count, buy_amount, sell_amount } // æ–°å¢
}
```

## ğŸ¯ æœ€ç»ˆæ•ˆæœ

### âœ… å®Œæˆçš„åŠŸèƒ½
1. **åŸºæœ¬ä¿¡æ¯æ˜¾ç¤º**: è‚¡ç¥¨åç§°ã€ä»·æ ¼ã€æ¶¨è·Œå¹…ç­‰æ ¸å¿ƒæ•°æ®æ­£å¸¸æ˜¾ç¤º
2. **åˆ†æ—¶å›¾æ•°æ®**: ä»·æ ¼çº¿ã€å‡ä»·çº¿ã€ä¸»åŠ›çº¿ã€æ•£æˆ·çº¿æ•°æ®æ¥æºå·²åˆ‡æ¢åˆ°æ–°æ¥å£
3. **å¤§å•ç»Ÿè®¡**: å„çº§åˆ«(300ä¸‡ã€100ä¸‡ã€50ä¸‡ã€30ä¸‡)çš„ä¹°å–ç¬”æ•°å’Œé‡‘é¢ç»Ÿè®¡
4. **å¤§å•æ˜ç»†**: å®æ—¶äº¤æ˜“è®°å½•åˆ—è¡¨ï¼ŒåŒ…å«æ—¶é—´ã€çŠ¶æ€ã€ä»·æ ¼ã€æ‰‹æ•°ã€é‡‘é¢
5. **æ•°æ®éªŒè¯**: ä¿ç•™åŸæœ‰çš„æ•°æ®éªŒè¯åŠŸèƒ½

### âœ… æ•°æ®æµè½¬å®Œæ•´æ€§
```
æ–°åç«¯æ¥å£ â†’ æ•°æ®æ ¼å¼è½¬æ¢ â†’ å‰ç«¯çŠ¶æ€ç®¡ç† â†’ UIç»„ä»¶æ˜¾ç¤º
     â†“              â†“              â†“           â†“
/api/v1/*   â†’   atoms.js    â†’   jotai store â†’ StockDashboard
```

## ğŸš€ éƒ¨ç½²å»ºè®®

1. **å‰ç«¯é…ç½®**: APIé…ç½®å·²åœ¨ `frontend/src/config/api.js` ä¸­è®¾ç½®ï¼Œæ”¯æŒç¯å¢ƒå˜é‡
2. **å¼€å‘è°ƒè¯•**: å¯é€šè¿‡è®¾ç½® `REACT_APP_DEBUG_API=true` å¼€å¯APIè°ƒè¯•æ—¥å¿—
3. **ç”Ÿäº§ç¯å¢ƒ**: ç¡®ä¿åç«¯æ¥å£åœ°å€é…ç½®æ­£ç¡®

## ğŸ“‹ æµ‹è¯•æ¸…å•

- [x] åŸºæœ¬ä¿¡æ¯æ¥å£æ•°æ®æ ¼å¼é€‚é…
- [x] å¤§å•ç»Ÿè®¡æ¥å£æ•°æ®è§£æ
- [x] å¤§å•æ˜ç»†æ¥å£æ•°æ®è½¬æ¢
- [x] åˆ†æ—¶å›¾æ¥å£æ•°æ®å¤„ç†
- [x] å‰ç«¯ç»„ä»¶æ•°æ®å®‰å…¨æ€§æ£€æŸ¥
- [x] é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ•è·
- [x] å•ä½è½¬æ¢é€»è¾‘éªŒè¯

---

**ğŸ“… é€‚é…å®Œæˆæ—¶é—´**: 2025-01-15  
**ğŸ”§ é€‚é…èŒƒå›´**: å‰ç«¯çŠ¶æ€ç®¡ç†å’Œæ•°æ®æ ¼å¼è½¬æ¢  
**âœ… é€‚é…çŠ¶æ€**: å®Œæˆï¼Œç­‰å¾…è”è°ƒæµ‹è¯• 