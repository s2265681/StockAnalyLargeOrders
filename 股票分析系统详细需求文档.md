# 股票大单分析系统详细需求文档

## 一、系统概述

基于图片分析，本系统为股票实时交易数据分析平台，主要功能为展示股票的分时走势、成交量分析、大单交易监控和实时交易明细。系统将实现类似图中所示的专业股票分析界面。

## 二、界面布局与功能模块分析

### 2.1 顶部信息栏
- **股票名称**: 平安银行
- **股票代码**: 000001 (深交所代码)
- **当前价格**: 12.73 (实时价格)
- **涨跌幅**: -1.93% (绿色表示下跌)
- **涨跌额**: 显示绝对涨跌金额
- **最高价**: 13.04
- **最低价**: 12.71
- **成交量**: 181.05万手
- **成交额**: 23.22亿

### 2.2 主图表区域 (核心功能)

#### 2.2.1 分时价格走势图 (白色线条)
- **含义**: 展示股票从开盘至当前时间的价格变化轨迹
- **颜色规则**: 
  - 白色线条：当前价格走势
  - 黄色线条：均价线（成交金额/成交股数）
- **时间轴**: X轴显示交易时间 (09:30-15:00，包含午休)
- **价格轴**: Y轴显示价格区间，以昨日收盘价为基准线

#### 2.2.2 大单主力资金线 (红色和绿色标识)
- **红色线/点**: 大单买入信号 (≥50万资金)
- **绿色线/点**: 散户或小单交易 (<50万资金)
- **分析意义**: 
  - 红色密集区域表示主力资金流入
  - 绿色区域表示散户参与或主力出货
  - 结合价格走势判断资金流向

#### 2.2.3 图例
- **D300**: 金额大于300万的大单
- **D100**: 金额大于100万小于300万的大单  
- **D50**: 买卖金额50万到100万的单
- **D30**: 买卖金额30万到50万的单

### 2.3 成交量柱状图 (底部)
- **位置**: 主图下方
- **颜色规则**:
  - 红色柱：价格上涨时的成交量
  - 绿色柱：价格下跌时的成交量
  - 白色柱：价格平盘时的成交量
- **分析意义**: 成交量放大配合价格突破，确认趋势有效性

### 2.4 大单统计区域 (右下角表格)
#### 2.4.1 资金流向统计
- **大于300万**: 超大单 (主力机构)
- **大于100万**: 大单 (中等资金)
- **大于50万**: 中单 (活跃资金)
- **小于30万**: 小单 (散户资金)

#### 2.4.2 实时成交明细
- **时间**: 具体成交时间
- **价格**: 成交价格
- **手数**: 成交数量
- **金额**: 成交金额
- **性质**: 买盘/卖盘标识

## 三、数据指标详细说明

### 3.1 价格类指标
- **当前价**: 12.73 - 最新成交价格
- **涨跌幅**: -1.93% - (当前价-昨收价)/昨收价×100%
- **高/低**: 13.04/12.71 - 当日最高价和最低价
- **开盘价**: 开市时首笔成交价
- **昨收价**: 上一交易日收盘价
- **流通市值**: 增加股票的流通市值
- **主要题材行业**: 增加股票所属的主要题材前三个，所属行业

### 3.2 成交量指标
- **成交量**: 181.05万手 - 累计成交股数
- **成交额**: 23.22亿 - 累计成交金额
- **换手率**: 成交量/流通股本×100%
- **量比**: 当前成交量/历史同期平均成交量

### 3.3 大单分析指标
- **主力净流入**: 大单买入-大单卖出
- **主力流入比**: 主力买入/总成交额×100%
- **散户参与度**: 小单成交/总成交额×100%
- **资金集中度**: 反映资金分布情况

## 四、技术实现方案

### 4.1 前端技术栈
```javascript
// 主要依赖
- React 18 (用户界面框架)
- Ant Design (UI组件库)
- TradingView Lightweight Charts (专业图表库)
- ECharts (数据可视化)
- Jotai (状态管理)
- WebSocket (实时数据推送)
```

### 4.2 图表实现细节

#### 4.2.1 分时图配置
```javascript
const timeshareConfig = {
  // 价格线配置
  priceLineConfig: {
    color: '#FFFFFF',        // 白色价格线
    lineWidth: 2,
    lineType: 'smooth'
  },
  // 均价线配置  
  avgLineConfig: {
    color: '#FFD700',        // 黄色均价线
    lineWidth: 1,
    lineType: 'straight'
  },
  // 大单标识
  largeOrderMarkers: {
    buyColor: '#FF4D4F',     // 红色买入
    sellColor: '#52C41A',    // 绿色卖出
    minAmount: 500000        // 50万起算大单
  }
}
```

#### 4.2.2 成交量图表
```javascript
const volumeConfig = {
  type: 'histogram',
  colorRules: {
    up: '#FF4D4F',          // 红色上涨
    down: '#52C41A',        // 绿色下跌
    equal: '#FFFFFF'        // 白色平盘
  },
  position: 'bottom',
  height: '30%'
}
```

### 4.3 数据接口设计

#### 4.3.1 基础数据接口
```javascript
// 获取股票基本信息
GET /api/stock/basic?code=000001
{
  "code": "000001",
  "name": "平安银行", 
  "current_price": 12.73,
  "change_amount": -0.25,
  "change_percent": -1.93,
  "high": 13.04,
  "low": 12.71,
  "volume": 1810500,
  "turnover": 2322000000,
  "yesterday_close": 12.98
}
```

#### 4.3.2 分时数据接口
```javascript
// 获取分时数据
GET /api/stock/timeshare?code=000001
{
  "timeshare": [
    {
      "time": "09:30:00",
      "price": 12.98,
      "volume": 1200,
      "avg_price": 12.98,
      "amount": 155760
    }
  ],
  "statistics": {
    "yesterdayClose": 12.98,
    "totalVolume": 1810500,
    "totalAmount": 2322000000
  }
}
```

#### 4.3.3 大单数据接口
```javascript
// 获取大单交易数据
GET /api/stock/large-orders?code=000001&min_amount=500000
{
  "largeOrders": [
    {
      "time": "15:00:00",
      "type": "buy",
      "price": 12.73,
      "volume": 6098,
      "amount": 776300
    }
  ],
  "summary": {
    "buyCount": 245,
    "sellCount": 189,
    "totalAmount": 850000000,
    "netInflow": 45000000
  }
}
```

## 五、平安银行数据验证方案

### 5.1 数据源接入
1. **同花顺API**: 获取实时行情数据
2. **新浪财经API**: 获取分时数据
3. **腾讯股票API**: 获取大单数据
4. **东方财富API**: 获取资金流向数据

### 5.2 数据验证流程
```python
def validate_pingan_bank_data():
    """
    验证平安银行(000001)数据准确性
    """
    # 1. 获取多源数据
    sina_data = fetch_sina_data('000001')
    tencent_data = fetch_tencent_data('000001')
    ifeng_data = fetch_ifeng_data('000001')
    
    # 2. 数据一致性校验
    price_diff = abs(sina_data.price - tencent_data.price)
    if price_diff > 0.01:  # 价格差异超过1分钱
        logger.warning(f"价格数据异常: 新浪{sina_data.price}, 腾讯{tencent_data.price}")
    
    # 3. 大单数据交叉验证
    validate_large_orders(sina_data.orders, tencent_data.orders)
    
    # 4. 实时性检查
    check_data_freshness(sina_data.timestamp)
    
    return {
        'status': 'valid',
        'data_source': 'aggregated',
        'last_update': datetime.now()
    }
```

### 5.3 关键验证点
1. **价格准确性**: 对比多个数据源的实时价格
2. **成交量一致性**: 验证分时成交量累计是否等于总成交量
3. **大单识别准确性**: 50万以上资金确实标记为大单
4. **时间同步性**: 确保数据时间戳的准确性

## 六、核心算法实现

### 6.1 大单识别算法
```python
def identify_large_orders(trades_data, threshold=500000):
    """
    识别大单交易
    """
    large_orders = []
    
    for trade in trades_data:
        amount = trade['price'] * trade['volume'] * 100  # 计算成交金额
        
        if amount >= threshold:
            order_type = 'buy' if trade['buy_flag'] else 'sell'
            large_orders.append({
                'time': trade['time'],
                'type': order_type,
                'price': trade['price'],
                'volume': trade['volume'],
                'amount': amount,
                'is_large': True
            })
    
    return large_orders
```

### 6.2 主力资金流向计算
```python
def calculate_capital_flow(large_orders):
    """
    计算主力资金流向
    """
    buy_amount = sum(order['amount'] for order in large_orders if order['type'] == 'buy')
    sell_amount = sum(order['amount'] for order in large_orders if order['type'] == 'sell')
    
    net_inflow = buy_amount - sell_amount
    total_amount = buy_amount + sell_amount
    
    return {
        'buy_amount': buy_amount,
        'sell_amount': sell_amount,
        'net_inflow': net_inflow,
        'inflow_ratio': net_inflow / total_amount if total_amount > 0 else 0
    }
```

## 七、部署与监控

### 7.1 系统部署
- **前端**: Nginx + React构建产物
- **后端**: Gunicorn + Flask + Python
- **数据库**: Redis (缓存) + MongoDB (历史数据)
- **消息队列**: RabbitMQ (实时数据推送)

### 7.2 性能监控
- **响应时间**: API响应时间 < 100ms
- **数据延迟**: 实时数据延迟 < 3秒  
- **并发能力**: 支持1000+并发用户
- **数据准确率**: 99.9%以上

## 八、后续扩展功能

1. **技术指标扩展**: MACD、KDJ、RSI等技术分析工具
2. **多周期分析**: 支持1分钟、5分钟、日线等多时间周期
3. **预警系统**: 大单异动、价格突破等实时预警
4. **历史回测**: 历史大单数据回测分析
5. **多股票对比**: 同时监控多只股票的资金流向

## 九、数据安全与合规

1. **数据来源合规**: 确保使用合法的股票数据源
2. **用户隐私保护**: 不存储用户敏感信息
3. **数据加密**: API传输数据加密
4. **访问控制**: 合理的API访问频率限制

---

*本需求文档基于平安银行(000001)股票交易界面分析，涵盖了专业股票分析系统的核心功能和技术实现方案。* 